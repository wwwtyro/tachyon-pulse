!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){!function(){"use strict";var shim={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(shim.exports={},define(function(){return shim.exports})):shim.exports=window:shim.exports=exports,function(exports){if(!GLMAT_EPSILON)var GLMAT_EPSILON=1e-6;if(!GLMAT_ARRAY_TYPE)var GLMAT_ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;var glMatrix={};glMatrix.setMatrixArrayType=function(type){GLMAT_ARRAY_TYPE=type},"undefined"!=typeof exports&&(exports.glMatrix=glMatrix);var vec2={};vec2.create=function(){var out=new GLMAT_ARRAY_TYPE(2);return out[0]=0,out[1]=0,out},vec2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(2);return out[0]=a[0],out[1]=a[1],out},vec2.fromValues=function(x,y){var out=new GLMAT_ARRAY_TYPE(2);return out[0]=x,out[1]=y,out},vec2.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out},vec2.set=function(out,x,y){return out[0]=x,out[1]=y,out},vec2.add=function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out},vec2.subtract=function(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out},vec2.sub=vec2.subtract,vec2.multiply=function(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out},vec2.mul=vec2.multiply,vec2.divide=function(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out},vec2.div=vec2.divide,vec2.min=function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out},vec2.max=function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out},vec2.scale=function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out},vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)},vec2.dist=vec2.distance,vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)},vec2.len=vec2.length,vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(out,a){return out[0]=-a[0],out[1]=-a[1],out},vec2.normalize=function(out,a){var x=a[0],y=a[1],len=x*x+y*y;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len),out},vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},vec2.cross=function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];return out[0]=out[1]=0,out[2]=z,out},vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out},vec2.transformMat2=function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y,out[1]=m[1]*x+m[3]*y,out},vec2.transformMat2d=function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y+m[4],out[1]=m[1]*x+m[3]*y+m[5],out},vec2.transformMat3=function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[3]*y+m[6],out[1]=m[1]*x+m[4]*y+m[7],out},vec2.transformMat4=function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[4]*y+m[12],out[1]=m[1]*x+m[5]*y+m[13],out},vec2.forEach=function(){var vec=vec2.create();return function(a,stride,offset,count,fn,arg){var i,l;for(stride||(stride=2),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;l>i;i+=stride)vec[0]=a[i],vec[1]=a[i+1],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1];return a}}(),vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},"undefined"!=typeof exports&&(exports.vec2=vec2);var vec3={};vec3.create=function(){var out=new GLMAT_ARRAY_TYPE(3);return out[0]=0,out[1]=0,out[2]=0,out},vec3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(3);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out},vec3.fromValues=function(x,y,z){var out=new GLMAT_ARRAY_TYPE(3);return out[0]=x,out[1]=y,out[2]=z,out},vec3.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out},vec3.set=function(out,x,y,z){return out[0]=x,out[1]=y,out[2]=z,out},vec3.add=function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out},vec3.subtract=function(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out},vec3.sub=vec3.subtract,vec3.multiply=function(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out},vec3.mul=vec3.multiply,vec3.divide=function(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out},vec3.div=vec3.divide,vec3.min=function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out},vec3.max=function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out},vec3.scale=function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out},vec3.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)},vec3.dist=vec3.distance,vec3.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z},vec3.sqrDist=vec3.squaredDistance,vec3.length=function(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)},vec3.len=vec3.length,vec3.squaredLength=function(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z},vec3.sqrLen=vec3.squaredLength,vec3.negate=function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out},vec3.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],len=x*x+y*y+z*z;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len,out[2]=a[2]*len),out},vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},vec3.cross=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];return out[0]=ay*bz-az*by,out[1]=az*bx-ax*bz,out[2]=ax*by-ay*bx,out},vec3.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out},vec3.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12],out[1]=m[1]*x+m[5]*y+m[9]*z+m[13],out[2]=m[2]*x+m[6]*y+m[10]*z+m[14],out},vec3.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy,out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz,out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx,out},vec3.forEach=function(){var vec=vec3.create();return function(a,stride,offset,count,fn,arg){var i,l;for(stride||(stride=3),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;l>i;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2];return a}}(),vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},"undefined"!=typeof exports&&(exports.vec3=vec3);var vec4={};vec4.create=function(){var out=new GLMAT_ARRAY_TYPE(4);return out[0]=0,out[1]=0,out[2]=0,out[3]=0,out},vec4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},vec4.fromValues=function(x,y,z,w){var out=new GLMAT_ARRAY_TYPE(4);return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out},vec4.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},vec4.set=function(out,x,y,z,w){return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out},vec4.add=function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out},vec4.subtract=function(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out},vec4.sub=vec4.subtract,vec4.multiply=function(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out[3]=a[3]*b[3],out},vec4.mul=vec4.multiply,vec4.divide=function(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out[3]=a[3]/b[3],out},vec4.div=vec4.divide,vec4.min=function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out[3]=Math.min(a[3],b[3]),out},vec4.max=function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out[3]=Math.max(a[3],b[3]),out},vec4.scale=function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out},vec4.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)},vec4.dist=vec4.distance,vec4.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w},vec4.sqrDist=vec4.squaredDistance,vec4.length=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)},vec4.len=vec4.length,vec4.squaredLength=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w},vec4.sqrLen=vec4.squaredLength,vec4.negate=function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=-a[3],out},vec4.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],w=a[3],len=x*x+y*y+z*z+w*w;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len,out[2]=a[2]*len,out[3]=a[3]*len),out},vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},vec4.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out[3]=aw+t*(b[3]-aw),out},vec4.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w,out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w,out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w,out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w,out},vec4.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy,out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz,out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx,out},vec4.forEach=function(){var vec=vec4.create();return function(a,stride,offset,count,fn,arg){var i,l;for(stride||(stride=4),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;l>i;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],vec[3]=a[i+3],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2],a[i+3]=vec[3];return a}}(),vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof exports&&(exports.vec4=vec4);{var mat2={};new Float32Array([1,0,0,1])}mat2.create=function(){var out=new GLMAT_ARRAY_TYPE(4);return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out},mat2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},mat2.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},mat2.identity=function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out},mat2.transpose=function(out,a){if(out===a){var a1=a[1];out[1]=a[2],out[2]=a1}else out[0]=a[0],out[1]=a[2],out[2]=a[1],out[3]=a[3];return out},mat2.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;return det?(det=1/det,out[0]=a3*det,out[1]=-a1*det,out[2]=-a2*det,out[3]=a0*det,out):null},mat2.adjoint=function(out,a){var a0=a[0];return out[0]=a[3],out[1]=-a[1],out[2]=-a[2],out[3]=a0,out},mat2.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},mat2.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=a0*b0+a1*b2,out[1]=a0*b1+a1*b3,out[2]=a2*b0+a3*b2,out[3]=a2*b1+a3*b3,out},mat2.mul=mat2.multiply,mat2.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);return out[0]=a0*c+a1*s,out[1]=a0*-s+a1*c,out[2]=a2*c+a3*s,out[3]=a2*-s+a3*c,out},mat2.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];return out[0]=a0*v0,out[1]=a1*v1,out[2]=a2*v0,out[3]=a3*v1,out},mat2.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof exports&&(exports.mat2=mat2);{var mat2d={};new Float32Array([1,0,0,1,0,0])}mat2d.create=function(){var out=new GLMAT_ARRAY_TYPE(6);return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out},mat2d.clone=function(a){var out=new GLMAT_ARRAY_TYPE(6);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},mat2d.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},mat2d.identity=function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out},mat2d.invert=function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],det=aa*ad-ab*ac;return det?(det=1/det,out[0]=ad*det,out[1]=-ab*det,out[2]=-ac*det,out[3]=aa*det,out[4]=(ac*aty-ad*atx)*det,out[5]=(ab*atx-aa*aty)*det,out):null},mat2d.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},mat2d.multiply=function(out,a,b){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],ba=b[0],bb=b[1],bc=b[2],bd=b[3],btx=b[4],bty=b[5];return out[0]=aa*ba+ab*bc,out[1]=aa*bb+ab*bd,out[2]=ac*ba+ad*bc,out[3]=ac*bb+ad*bd,out[4]=ba*atx+bc*aty+btx,out[5]=bb*atx+bd*aty+bty,out},mat2d.mul=mat2d.multiply,mat2d.rotate=function(out,a,rad){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],st=Math.sin(rad),ct=Math.cos(rad);return out[0]=aa*ct+ab*st,out[1]=-aa*st+ab*ct,out[2]=ac*ct+ad*st,out[3]=-ac*st+ct*ad,out[4]=ct*atx+st*aty,out[5]=ct*aty-st*atx,out},mat2d.scale=function(out,a,v){var vx=v[0],vy=v[1];return out[0]=a[0]*vx,out[1]=a[1]*vy,out[2]=a[2]*vx,out[3]=a[3]*vy,out[4]=a[4]*vx,out[5]=a[5]*vy,out},mat2d.translate=function(out,a,v){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4]+v[0],out[5]=a[5]+v[1],out},mat2d.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},"undefined"!=typeof exports&&(exports.mat2d=mat2d);{var mat3={};new Float32Array([1,0,0,0,1,0,0,0,1])}mat3.create=function(){var out=new GLMAT_ARRAY_TYPE(9);return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},mat3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(9);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},mat3.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},mat3.identity=function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},mat3.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3],out[2]=a[6],out[3]=a01,out[5]=a[7],out[6]=a02,out[7]=a12}else out[0]=a[0],out[1]=a[3],out[2]=a[6],out[3]=a[1],out[4]=a[4],out[5]=a[7],out[6]=a[2],out[7]=a[5],out[8]=a[8];return out},mat3.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;return det?(det=1/det,out[0]=b01*det,out[1]=(-a22*a01+a02*a21)*det,out[2]=(a12*a01-a02*a11)*det,out[3]=b11*det,out[4]=(a22*a00-a02*a20)*det,out[5]=(-a12*a00+a02*a10)*det,out[6]=b21*det,out[7]=(-a21*a00+a01*a20)*det,out[8]=(a11*a00-a01*a10)*det,out):null},mat3.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return out[0]=a11*a22-a12*a21,out[1]=a02*a21-a01*a22,out[2]=a01*a12-a02*a11,out[3]=a12*a20-a10*a22,out[4]=a00*a22-a02*a20,out[5]=a02*a10-a00*a12,out[6]=a10*a21-a11*a20,out[7]=a01*a20-a00*a21,out[8]=a00*a11-a01*a10,out},mat3.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)},mat3.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];return out[0]=b00*a00+b01*a10+b02*a20,out[1]=b00*a01+b01*a11+b02*a21,out[2]=b00*a02+b01*a12+b02*a22,out[3]=b10*a00+b11*a10+b12*a20,out[4]=b10*a01+b11*a11+b12*a21,out[5]=b10*a02+b11*a12+b12*a22,out[6]=b20*a00+b21*a10+b22*a20,out[7]=b20*a01+b21*a11+b22*a21,out[8]=b20*a02+b21*a12+b22*a22,out},mat3.mul=mat3.multiply,mat3.translate=function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];return out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a10,out[4]=a11,out[5]=a12,out[6]=x*a00+y*a10+a20,out[7]=x*a01+y*a11+a21,out[8]=x*a02+y*a12+a22,out},mat3.rotate=function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);return out[0]=c*a00+s*a10,out[1]=c*a01+s*a11,out[2]=c*a02+s*a12,out[3]=c*a10-s*a00,out[4]=c*a11-s*a01,out[5]=c*a12-s*a02,out[6]=a20,out[7]=a21,out[8]=a22,out},mat3.scale=function(out,a,v){var x=v[0],y=v[2];return out[0]=x*a[0],out[1]=x*a[1],out[2]=x*a[2],out[3]=y*a[3],out[4]=y*a[4],out[5]=y*a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},mat3.fromMat2d=function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=0,out[3]=a[2],out[4]=a[3],out[5]=0,out[6]=a[4],out[7]=a[5],out[8]=1,out},mat3.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=xy-wz,out[4]=1-(xx+zz),out[5]=yz+wx,out[6]=xz+wy,out[7]=yz-wx,out[8]=1-(xx+yy),out},mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},"undefined"!=typeof exports&&(exports.mat3=mat3);{var mat4={};new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}mat4.create=function(){var out=new GLMAT_ARRAY_TYPE(16);return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},mat4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(16);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out},mat4.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out},mat4.identity=function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},mat4.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a01,out[6]=a[9],out[7]=a[13],out[8]=a02,out[9]=a12,out[11]=a[14],out[12]=a03,out[13]=a13,out[14]=a23}else out[0]=a[0],out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a[1],out[5]=a[5],out[6]=a[9],out[7]=a[13],out[8]=a[2],out[9]=a[6],out[10]=a[10],out[11]=a[14],out[12]=a[3],out[13]=a[7],out[14]=a[11],out[15]=a[15];return out},mat4.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(det=1/det,out[0]=(a11*b11-a12*b10+a13*b09)*det,out[1]=(a02*b10-a01*b11-a03*b09)*det,out[2]=(a31*b05-a32*b04+a33*b03)*det,out[3]=(a22*b04-a21*b05-a23*b03)*det,out[4]=(a12*b08-a10*b11-a13*b07)*det,out[5]=(a00*b11-a02*b08+a03*b07)*det,out[6]=(a32*b02-a30*b05-a33*b01)*det,out[7]=(a20*b05-a22*b02+a23*b01)*det,out[8]=(a10*b10-a11*b08+a13*b06)*det,out[9]=(a01*b08-a00*b10-a03*b06)*det,out[10]=(a30*b04-a31*b02+a33*b00)*det,out[11]=(a21*b02-a20*b04-a23*b00)*det,out[12]=(a11*b07-a10*b09-a12*b06)*det,out[13]=(a00*b09-a01*b07+a02*b06)*det,out[14]=(a31*b01-a30*b03-a32*b00)*det,out[15]=(a20*b03-a21*b01+a22*b00)*det,out):null},mat4.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22),out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22)),out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12),out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12)),out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22)),out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22),out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12)),out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12),out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21),out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21)),out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11),out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11)),out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21)),out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21),out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11)),out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11),out},mat4.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06},mat4.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out},mat4.mul=mat4.multiply,mat4.translate=function(out,a,v){var a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,x=v[0],y=v[1],z=v[2];return a===out?(out[12]=a[0]*x+a[4]*y+a[8]*z+a[12],out[13]=a[1]*x+a[5]*y+a[9]*z+a[13],out[14]=a[2]*x+a[6]*y+a[10]*z+a[14],out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]):(a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a03,out[4]=a10,out[5]=a11,out[6]=a12,out[7]=a13,out[8]=a20,out[9]=a21,out[10]=a22,out[11]=a23,out[12]=a00*x+a10*y+a20*z+a[12],out[13]=a01*x+a11*y+a21*z+a[13],out[14]=a02*x+a12*y+a22*z+a[14],out[15]=a03*x+a13*y+a23*z+a[15]),out},mat4.scale=function(out,a,v){var x=v[0],y=v[1],z=v[2];return out[0]=a[0]*x,out[1]=a[1]*x,out[2]=a[2]*x,out[3]=a[3]*x,out[4]=a[4]*y,out[5]=a[5]*y,out[6]=a[6]*y,out[7]=a[7]*y,out[8]=a[8]*z,out[9]=a[9]*z,out[10]=a[10]*z,out[11]=a[11]*z,out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out},mat4.rotate=function(out,a,rad,axis){var s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);return Math.abs(len)<GLMAT_EPSILON?null:(len=1/len,x*=len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),t=1-c,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],b00=x*x*t+c,b01=y*x*t+z*s,b02=z*x*t-y*s,b10=x*y*t-z*s,b11=y*y*t+c,b12=z*y*t+x*s,b20=x*z*t+y*s,b21=y*z*t-x*s,b22=z*z*t+c,out[0]=a00*b00+a10*b01+a20*b02,out[1]=a01*b00+a11*b01+a21*b02,out[2]=a02*b00+a12*b01+a22*b02,out[3]=a03*b00+a13*b01+a23*b02,out[4]=a00*b10+a10*b11+a20*b12,out[5]=a01*b10+a11*b11+a21*b12,out[6]=a02*b10+a12*b11+a22*b12,out[7]=a03*b10+a13*b11+a23*b12,out[8]=a00*b20+a10*b21+a20*b22,out[9]=a01*b20+a11*b21+a21*b22,out[10]=a02*b20+a12*b21+a22*b22,out[11]=a03*b20+a13*b21+a23*b22,a!==out&&(out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out)},mat4.rotateX=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[4]=a10*c+a20*s,out[5]=a11*c+a21*s,out[6]=a12*c+a22*s,out[7]=a13*c+a23*s,out[8]=a20*c-a10*s,out[9]=a21*c-a11*s,out[10]=a22*c-a12*s,out[11]=a23*c-a13*s,out},mat4.rotateY=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c-a20*s,out[1]=a01*c-a21*s,out[2]=a02*c-a22*s,out[3]=a03*c-a23*s,out[8]=a00*s+a20*c,out[9]=a01*s+a21*c,out[10]=a02*s+a22*c,out[11]=a03*s+a23*c,out},mat4.rotateZ=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];return a!==out&&(out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c+a10*s,out[1]=a01*c+a11*s,out[2]=a02*c+a12*s,out[3]=a03*c+a13*s,out[4]=a10*c-a00*s,out[5]=a11*c-a01*s,out[6]=a12*c-a02*s,out[7]=a13*c-a03*s,out},mat4.fromRotationTranslation=function(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=0,out[4]=xy-wz,out[5]=1-(xx+zz),out[6]=yz+wx,out[7]=0,out[8]=xz+wy,out[9]=yz-wx,out[10]=1-(xx+yy),out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out},mat4.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=0,out[4]=xy-wz,out[5]=1-(xx+zz),out[6]=yz+wx,out[7]=0,out[8]=xz+wy,out[9]=yz-wx,out[10]=1-(xx+yy),out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},mat4.frustum=function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);return out[0]=2*near*rl,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=2*near*tb,out[6]=0,out[7]=0,out[8]=(right+left)*rl,out[9]=(top+bottom)*tb,out[10]=(far+near)*nf,out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near*2*nf,out[15]=0,out},mat4.perspective=function(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=(far+near)*nf,out[11]=-1,out[12]=0,out[13]=0,out[14]=2*far*near*nf,out[15]=0,out},mat4.ortho=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);return out[0]=-2*lr,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=-2*bt,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=2*nf,out[11]=0,out[12]=(left+right)*lr,out[13]=(top+bottom)*bt,out[14]=(far+near)*nf,out[15]=1,out},mat4.lookAt=function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<GLMAT_EPSILON&&Math.abs(eyey-centery)<GLMAT_EPSILON&&Math.abs(eyez-centerz)<GLMAT_EPSILON?mat4.identity(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,len=1/Math.sqrt(z0*z0+z1*z1+z2*z2),z0*=len,z1*=len,z2*=len,x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0,len=Math.sqrt(x0*x0+x1*x1+x2*x2),len?(len=1/len,x0*=len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,len=Math.sqrt(y0*y0+y1*y1+y2*y2),len?(len=1/len,y0*=len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)},mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},"undefined"!=typeof exports&&(exports.mat4=mat4);{var quat={};new Float32Array([0,0,0,1])}quat.create=function(){var out=new GLMAT_ARRAY_TYPE(4);return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out},quat.clone=vec4.clone,quat.fromValues=vec4.fromValues,quat.copy=vec4.copy,quat.set=vec4.set,quat.identity=function(out){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out},quat.setAxisAngle=function(out,axis,rad){rad=.5*rad;var s=Math.sin(rad);return out[0]=s*axis[0],out[1]=s*axis[1],out[2]=s*axis[2],out[3]=Math.cos(rad),out},quat.add=vec4.add,quat.multiply=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];return out[0]=ax*bw+aw*bx+ay*bz-az*by,out[1]=ay*bw+aw*by+az*bx-ax*bz,out[2]=az*bw+aw*bz+ax*by-ay*bx,out[3]=aw*bw-ax*bx-ay*by-az*bz,out},quat.mul=quat.multiply,quat.scale=vec4.scale,quat.rotateX=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+aw*bx,out[1]=ay*bw+az*bx,out[2]=az*bw-ay*bx,out[3]=aw*bw-ax*bx,out},quat.rotateY=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw-az*by,out[1]=ay*bw+aw*by,out[2]=az*bw+ax*by,out[3]=aw*bw-ay*by,out},quat.rotateZ=function(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+ay*bz,out[1]=ay*bw-ax*bz,out[2]=az*bw+aw*bz,out[3]=aw*bw-az*bz,out},quat.calculateW=function(out,a){var x=a[0],y=a[1],z=a[2];return out[0]=x,out[1]=y,out[2]=z,out[3]=-Math.sqrt(Math.abs(1-x*x-y*y-z*z)),out},quat.dot=vec4.dot,quat.lerp=vec4.lerp,quat.slerp=function(out,a,b,t){var halfTheta,sinHalfTheta,ratioA,ratioB,ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3],cosHalfTheta=ax*bx+ay*by+az*bz+aw*bw;return Math.abs(cosHalfTheta)>=1?(out!==a&&(out[0]=ax,out[1]=ay,out[2]=az,out[3]=aw),out):(halfTheta=Math.acos(cosHalfTheta),sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta),Math.abs(sinHalfTheta)<.001?(out[0]=.5*ax+.5*bx,out[1]=.5*ay+.5*by,out[2]=.5*az+.5*bz,out[3]=.5*aw+.5*bw,out):(ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta,out[0]=ax*ratioA+bx*ratioB,out[1]=ay*ratioA+by*ratioB,out[2]=az*ratioA+bz*ratioB,out[3]=aw*ratioA+bw*ratioB,out))},quat.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;return out[0]=-a0*invDot,out[1]=-a1*invDot,out[2]=-a2*invDot,out[3]=a3*invDot,out},quat.conjugate=function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=a[3],out},quat.length=vec4.length,quat.len=quat.length,quat.squaredLength=vec4.squaredLength,quat.sqrLen=quat.squaredLength,quat.normalize=vec4.normalize,quat.fromMat3=function(){var s_iNext=[1,2,0];return function(out,m){var fRoot,fTrace=m[0]+m[4]+m[8];if(fTrace>0)fRoot=Math.sqrt(fTrace+1),out[3]=.5*fRoot,fRoot=.5/fRoot,out[0]=(m[7]-m[5])*fRoot,out[1]=(m[2]-m[6])*fRoot,out[2]=(m[3]-m[1])*fRoot;else{var i=0;m[4]>m[0]&&(i=1),m[8]>m[3*i+i]&&(i=2);var j=s_iNext[i],k=s_iNext[j];fRoot=Math.sqrt(m[3*i+i]-m[3*j+j]-m[3*k+k]+1),out[i]=.5*fRoot,fRoot=.5/fRoot,out[3]=(m[3*k+j]-m[3*j+k])*fRoot,out[j]=(m[3*j+i]+m[3*i+j])*fRoot,out[k]=(m[3*k+i]+m[3*i+k])*fRoot
}return out}}(),quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},"undefined"!=typeof exports&&(exports.quat=quat)}(shim.exports)}()},{}],2:[function(require,module,exports){!function(){var cache={},ctx=null,usingWebAudio=!0,noAudio=!1;try{"undefined"!=typeof AudioContext?ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?ctx=new webkitAudioContext:usingWebAudio=!1}catch(e){usingWebAudio=!1}if(!usingWebAudio)if("undefined"!=typeof Audio)try{new Audio}catch(e){noAudio=!0}else noAudio=!0;if(usingWebAudio){var masterGain="undefined"==typeof ctx.createGain?ctx.createGainNode():ctx.createGain();masterGain.gain.value=1,masterGain.connect(ctx.destination)}var HowlerGlobal=function(codecs){this._volume=1,this._muted=!1,this.usingWebAudio=usingWebAudio,this.ctx=ctx,this.noAudio=noAudio,this._howls=[],this._codecs=codecs,this.iOSAutoEnable=!0};HowlerGlobal.prototype={volume:function(vol){var self=this;if(vol=parseFloat(vol),vol>=0&&1>=vol){self._volume=vol,usingWebAudio&&(masterGain.gain.value=vol);for(var key in self._howls)if(self._howls.hasOwnProperty(key)&&self._howls[key]._webAudio===!1)for(var i=0;i<self._howls[key]._audioNode.length;i++)self._howls[key]._audioNode[i].volume=self._howls[key]._volume*self._volume;return self}return usingWebAudio?masterGain.gain.value:self._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(muted){var self=this;self._muted=muted,usingWebAudio&&(masterGain.gain.value=muted?0:self._volume);for(var key in self._howls)if(self._howls.hasOwnProperty(key)&&self._howls[key]._webAudio===!1)for(var i=0;i<self._howls[key]._audioNode.length;i++)self._howls[key]._audioNode[i].muted=muted},codecs:function(ext){return this._codecs[ext]},_enableiOSAudio:function(){var self=this;if(!ctx||!self._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){self._iOSEnabled=!1;var unlock=function(){var buffer=ctx.createBuffer(1,1,22050),source=ctx.createBufferSource();source.buffer=buffer,source.connect(ctx.destination),"undefined"==typeof source.start?source.noteOn(0):source.start(0),setTimeout(function(){(source.playbackState===source.PLAYING_STATE||source.playbackState===source.FINISHED_STATE)&&(self._iOSEnabled=!0,self.iOSAutoEnable=!1,window.removeEventListener("touchstart",unlock,!1))},0)};return window.addEventListener("touchstart",unlock,!1),self}}};var audioTest=null,codecs={};noAudio||(audioTest=new Audio,codecs={mp3:!!audioTest.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!audioTest.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!audioTest.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!audioTest.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(audioTest.canPlayType("audio/x-m4a;")||audioTest.canPlayType("audio/m4a;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(audioTest.canPlayType("audio/x-mp4;")||audioTest.canPlayType("audio/mp4;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var Howler=new HowlerGlobal(codecs),Howl=function(o){var self=this;self._autoplay=o.autoplay||!1,self._buffer=o.buffer||!1,self._duration=o.duration||0,self._format=o.format||null,self._loop=o.loop||!1,self._loaded=!1,self._sprite=o.sprite||{},self._src=o.src||"",self._pos3d=o.pos3d||[0,0,-.5],self._volume=void 0!==o.volume?o.volume:1,self._urls=o.urls||[],self._rate=o.rate||1,self._model=o.model||null,self._onload=[o.onload||function(){}],self._onloaderror=[o.onloaderror||function(){}],self._onend=[o.onend||function(){}],self._onpause=[o.onpause||function(){}],self._onplay=[o.onplay||function(){}],self._onendTimer=[],self._webAudio=usingWebAudio&&!self._buffer,self._audioNode=[],self._webAudio&&self._setupAudioNode(),"undefined"!=typeof ctx&&ctx&&Howler.iOSAutoEnable&&Howler._enableiOSAudio(),Howler._howls.push(self),self.load()};if(Howl.prototype={load:function(){var self=this,url=null;if(noAudio)return void self.on("loaderror");for(var i=0;i<self._urls.length;i++){var ext,urlItem;if(self._format)ext=self._format;else{if(urlItem=self._urls[i],ext=/^data:audio\/([^;,]+);/i.exec(urlItem),ext||(ext=/\.([^.]+)$/.exec(urlItem.split("?",1)[0])),!ext)return void self.on("loaderror");ext=ext[1].toLowerCase()}if(codecs[ext]){url=self._urls[i];break}}if(!url)return void self.on("loaderror");if(self._src=url,self._webAudio)loadBuffer(self,url);else{var newNode=new Audio;newNode.addEventListener("error",function(){newNode.error&&4===newNode.error.code&&(HowlerGlobal.noAudio=!0),self.on("loaderror",{type:newNode.error?newNode.error.code:0})},!1),self._audioNode.push(newNode),newNode.src=url,newNode._pos=0,newNode.preload="auto",newNode.volume=Howler._muted?0:self._volume*Howler.volume();var listener=function(){self._duration=Math.ceil(10*newNode.duration)/10,0===Object.getOwnPropertyNames(self._sprite).length&&(self._sprite={_default:[0,1e3*self._duration]}),self._loaded||(self._loaded=!0,self.on("load")),self._autoplay&&self.play(),newNode.removeEventListener("canplaythrough",listener,!1)};newNode.addEventListener("canplaythrough",listener,!1),newNode.load()}return self},urls:function(urls){var self=this;return urls?(self.stop(),self._urls="string"==typeof urls?[urls]:urls,self._loaded=!1,self.load(),self):self._urls},play:function(sprite,callback){var self=this;return"function"==typeof sprite&&(callback=sprite),sprite&&"function"!=typeof sprite||(sprite="_default"),self._loaded?self._sprite[sprite]?(self._inactiveNode(function(node){node._sprite=sprite;var pos=node._pos>0?node._pos:self._sprite[sprite][0]/1e3,duration=0;self._webAudio?(duration=self._sprite[sprite][1]/1e3-node._pos,node._pos>0&&(pos=self._sprite[sprite][0]/1e3+pos)):duration=self._sprite[sprite][1]/1e3-(pos-self._sprite[sprite][0]/1e3);var timerId,loop=!(!self._loop&&!self._sprite[sprite][2]),soundId="string"==typeof callback?callback:Math.round(Date.now()*Math.random())+"";if(function(){var data={id:soundId,sprite:sprite,loop:loop};timerId=setTimeout(function(){!self._webAudio&&loop&&self.stop(data.id).play(sprite,data.id),self._webAudio&&!loop&&(self._nodeById(data.id).paused=!0,self._nodeById(data.id)._pos=0,self._clearEndTimer(data.id)),self._webAudio||loop||self.stop(data.id),self.on("end",soundId)},1e3*duration),self._onendTimer.push({timer:timerId,id:data.id})}(),self._webAudio){var loopStart=self._sprite[sprite][0]/1e3,loopEnd=self._sprite[sprite][1]/1e3;node.id=soundId,node.paused=!1,refreshBuffer(self,[loop,loopStart,loopEnd],soundId),self._playStart=ctx.currentTime,node.gain.value=self._volume,"undefined"==typeof node.bufferSource.start?node.bufferSource.noteGrainOn(0,pos,duration):node.bufferSource.start(0,pos,duration)}else{if(4!==node.readyState&&(node.readyState||!navigator.isCocoonJS))return self._clearEndTimer(soundId),function(){var sound=self,playSprite=sprite,fn=callback,newNode=node,listener=function(){sound.play(playSprite,fn),newNode.removeEventListener("canplaythrough",listener,!1)};newNode.addEventListener("canplaythrough",listener,!1)}(),self;node.readyState=4,node.id=soundId,node.currentTime=pos,node.muted=Howler._muted||node.muted,node.volume=self._volume*Howler.volume(),setTimeout(function(){node.play()},0)}return self.on("play"),"function"==typeof callback&&callback(soundId),self}),self):("function"==typeof callback&&callback(),self):(self.on("load",function(){self.play(sprite,callback)}),self)},pause:function(id){var self=this;if(!self._loaded)return self.on("play",function(){self.pause(id)}),self;self._clearEndTimer(id);var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode)if(activeNode._pos=self.pos(null,id),self._webAudio){if(!activeNode.bufferSource||activeNode.paused)return self;activeNode.paused=!0,"undefined"==typeof activeNode.bufferSource.stop?activeNode.bufferSource.noteOff(0):activeNode.bufferSource.stop(0)}else activeNode.pause();return self.on("pause"),self},stop:function(id){var self=this;if(!self._loaded)return self.on("play",function(){self.stop(id)}),self;self._clearEndTimer(id);var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode)if(activeNode._pos=0,self._webAudio){if(!activeNode.bufferSource||activeNode.paused)return self;activeNode.paused=!0,"undefined"==typeof activeNode.bufferSource.stop?activeNode.bufferSource.noteOff(0):activeNode.bufferSource.stop(0)}else isNaN(activeNode.duration)||(activeNode.pause(),activeNode.currentTime=0);return self},mute:function(id){var self=this;if(!self._loaded)return self.on("play",function(){self.mute(id)}),self;var activeNode=id?self._nodeById(id):self._activeNode();return activeNode&&(self._webAudio?activeNode.gain.value=0:activeNode.muted=!0),self},unmute:function(id){var self=this;if(!self._loaded)return self.on("play",function(){self.unmute(id)}),self;var activeNode=id?self._nodeById(id):self._activeNode();return activeNode&&(self._webAudio?activeNode.gain.value=self._volume:activeNode.muted=!1),self},volume:function(vol,id){var self=this;if(vol=parseFloat(vol),vol>=0&&1>=vol){if(self._volume=vol,!self._loaded)return self.on("play",function(){self.volume(vol,id)}),self;var activeNode=id?self._nodeById(id):self._activeNode();return activeNode&&(self._webAudio?activeNode.gain.value=vol:activeNode.volume=vol*Howler.volume()),self}return self._volume},loop:function(loop){var self=this;return"boolean"==typeof loop?(self._loop=loop,self):self._loop},sprite:function(sprite){var self=this;return"object"==typeof sprite?(self._sprite=sprite,self):self._sprite},pos:function(pos,id){var self=this;if(!self._loaded)return self.on("load",function(){self.pos(pos)}),"number"==typeof pos?self:self._pos||0;pos=parseFloat(pos);var activeNode=id?self._nodeById(id):self._activeNode();if(activeNode)return pos>=0?(self.pause(id),activeNode._pos=pos,self.play(activeNode._sprite,id),self):self._webAudio?activeNode._pos+(ctx.currentTime-self._playStart):activeNode.currentTime;if(pos>=0)return self;for(var i=0;i<self._audioNode.length;i++)if(self._audioNode[i].paused&&4===self._audioNode[i].readyState)return self._webAudio?self._audioNode[i]._pos:self._audioNode[i].currentTime},pos3d:function(x,y,z,id){var self=this;if(y="undefined"!=typeof y&&y?y:0,z="undefined"!=typeof z&&z?z:-.5,!self._loaded)return self.on("play",function(){self.pos3d(x,y,z,id)}),self;if(!(x>=0||0>x))return self._pos3d;if(self._webAudio){var activeNode=id?self._nodeById(id):self._activeNode();activeNode&&(self._pos3d=[x,y,z],activeNode.panner.setPosition(x,y,z),activeNode.panner.panningModel=self._model||"HRTF")}return self},fade:function(from,to,len,callback,id){var self=this,diff=Math.abs(from-to),dir=from>to?"down":"up",steps=diff/.01,stepTime=len/steps;if(!self._loaded)return self.on("load",function(){self.fade(from,to,len,callback,id)}),self;self.volume(from,id);for(var i=1;steps>=i;i++)!function(){var change=self._volume+("up"===dir?.01:-.01)*i,vol=Math.round(1e3*change)/1e3,toVol=to;setTimeout(function(){self.volume(vol,id),vol===toVol&&callback&&callback()},stepTime*i)}()},fadeIn:function(to,len,callback){return this.volume(0).play().fade(0,to,len,callback)},fadeOut:function(to,len,callback,id){var self=this;return self.fade(self._volume,to,len,function(){callback&&callback(),self.pause(id),self.on("end")},id)},_nodeById:function(id){for(var self=this,node=self._audioNode[0],i=0;i<self._audioNode.length;i++)if(self._audioNode[i].id===id){node=self._audioNode[i];break}return node},_activeNode:function(){for(var self=this,node=null,i=0;i<self._audioNode.length;i++)if(!self._audioNode[i].paused){node=self._audioNode[i];break}return self._drainPool(),node},_inactiveNode:function(callback){for(var self=this,node=null,i=0;i<self._audioNode.length;i++)if(self._audioNode[i].paused&&4===self._audioNode[i].readyState){callback(self._audioNode[i]),node=!0;break}if(self._drainPool(),!node){var newNode;if(self._webAudio)newNode=self._setupAudioNode(),callback(newNode);else{self.load(),newNode=self._audioNode[self._audioNode.length-1];var listenerEvent=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",listener=function(){newNode.removeEventListener(listenerEvent,listener,!1),callback(newNode)};newNode.addEventListener(listenerEvent,listener,!1)}}},_drainPool:function(){var i,self=this,inactive=0;for(i=0;i<self._audioNode.length;i++)self._audioNode[i].paused&&inactive++;for(i=self._audioNode.length-1;i>=0&&!(5>=inactive);i--)self._audioNode[i].paused&&(self._webAudio&&self._audioNode[i].disconnect(0),inactive--,self._audioNode.splice(i,1))},_clearEndTimer:function(soundId){for(var self=this,index=0,i=0;i<self._onendTimer.length;i++)if(self._onendTimer[i].id===soundId){index=i;break}var timer=self._onendTimer[index];timer&&(clearTimeout(timer.timer),self._onendTimer.splice(index,1))},_setupAudioNode:function(){var self=this,node=self._audioNode,index=self._audioNode.length;return node[index]="undefined"==typeof ctx.createGain?ctx.createGainNode():ctx.createGain(),node[index].gain.value=self._volume,node[index].paused=!0,node[index]._pos=0,node[index].readyState=4,node[index].connect(masterGain),node[index].panner=ctx.createPanner(),node[index].panner.panningModel=self._model||"equalpower",node[index].panner.setPosition(self._pos3d[0],self._pos3d[1],self._pos3d[2]),node[index].panner.connect(node[index]),node[index]},on:function(event,fn){var self=this,events=self["_on"+event];if("function"==typeof fn)events.push(fn);else for(var i=0;i<events.length;i++)fn?events[i].call(self,fn):events[i].call(self);return self},off:function(event,fn){var self=this,events=self["_on"+event],fnString=fn?fn.toString():null;if(fnString){for(var i=0;i<events.length;i++)if(fnString===events[i].toString()){events.splice(i,1);break}}else self["_on"+event]=[];return self},unload:function(){for(var self=this,nodes=self._audioNode,i=0;i<self._audioNode.length;i++)nodes[i].paused||(self.stop(nodes[i].id),self.on("end",nodes[i].id)),self._webAudio?nodes[i].disconnect(0):nodes[i].src="";for(i=0;i<self._onendTimer.length;i++)clearTimeout(self._onendTimer[i].timer);var index=Howler._howls.indexOf(self);null!==index&&index>=0&&Howler._howls.splice(index,1),delete cache[self._src],self=null}},usingWebAudio)var loadBuffer=function(obj,url){if(url in cache)return obj._duration=cache[url].duration,void loadSound(obj);if(/^data:[^;]+;base64,/.test(url)){for(var data=atob(url.split(",")[1]),dataView=new Uint8Array(data.length),i=0;i<data.length;++i)dataView[i]=data.charCodeAt(i);decodeAudioData(dataView.buffer,obj,url)}else{var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="arraybuffer",xhr.onload=function(){decodeAudioData(xhr.response,obj,url)},xhr.onerror=function(){obj._webAudio&&(obj._buffer=!0,obj._webAudio=!1,obj._audioNode=[],delete obj._gainNode,delete cache[url],obj.load())};try{xhr.send()}catch(e){xhr.onerror()}}},decodeAudioData=function(arraybuffer,obj,url){ctx.decodeAudioData(arraybuffer,function(buffer){buffer&&(cache[url]=buffer,loadSound(obj,buffer))},function(){obj.on("loaderror")})},loadSound=function(obj,buffer){obj._duration=buffer?buffer.duration:obj._duration,0===Object.getOwnPropertyNames(obj._sprite).length&&(obj._sprite={_default:[0,1e3*obj._duration]}),obj._loaded||(obj._loaded=!0,obj.on("load")),obj._autoplay&&obj.play()},refreshBuffer=function(obj,loop,id){var node=obj._nodeById(id);node.bufferSource=ctx.createBufferSource(),node.bufferSource.buffer=cache[obj._src],node.bufferSource.connect(node.panner),node.bufferSource.loop=loop[0],loop[0]&&(node.bufferSource.loopStart=loop[1],node.bufferSource.loopEnd=loop[1]+loop[2]),node.bufferSource.playbackRate.value=obj._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:Howler,Howl:Howl}}),"undefined"!=typeof exports&&(exports.Howler=Howler,exports.Howl=Howl),"undefined"!=typeof window&&(window.Howler=Howler,window.Howl=Howl)}()},{}],3:[function(require,module){module.exports=SimplexNoise=function(r){void 0==r&&(r=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var i=0;256>i;i++)this.p[i]=Math.floor(256*r.random());this.perm=[];for(var i=0;512>i;i++)this.perm[i]=this.p[255&i];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]},SimplexNoise.prototype.dot=function(g,x,y){return g[0]*x+g[1]*y},SimplexNoise.prototype.noise=function(xin,yin){var n0,n1,n2,i1,j1,F2=.5*(Math.sqrt(3)-1),s=(xin+yin)*F2,i=Math.floor(xin+s),j=Math.floor(yin+s),G2=(3-Math.sqrt(3))/6,t=(i+j)*G2,X0=i-t,Y0=j-t,x0=xin-X0,y0=yin-Y0;x0>y0?(i1=1,j1=0):(i1=0,j1=1);var x1=x0-i1+G2,y1=y0-j1+G2,x2=x0-1+2*G2,y2=y0-1+2*G2,ii=255&i,jj=255&j,gi0=this.perm[ii+this.perm[jj]]%12,gi1=this.perm[ii+i1+this.perm[jj+j1]]%12,gi2=this.perm[ii+1+this.perm[jj+1]]%12,t0=.5-x0*x0-y0*y0;0>t0?n0=0:(t0*=t0,n0=t0*t0*this.dot(this.grad3[gi0],x0,y0));var t1=.5-x1*x1-y1*y1;0>t1?n1=0:(t1*=t1,n1=t1*t1*this.dot(this.grad3[gi1],x1,y1));var t2=.5-x2*x2-y2*y2;return 0>t2?n2=0:(t2*=t2,n2=t2*t2*this.dot(this.grad3[gi2],x2,y2)),70*(n0+n1+n2)},SimplexNoise.prototype.noise3d=function(xin,yin,zin){var n0,n1,n2,n3,i1,j1,k1,i2,j2,k2,F3=1/3,s=(xin+yin+zin)*F3,i=Math.floor(xin+s),j=Math.floor(yin+s),k=Math.floor(zin+s),G3=1/6,t=(i+j+k)*G3,X0=i-t,Y0=j-t,Z0=k-t,x0=xin-X0,y0=yin-Y0,z0=zin-Z0;x0>=y0?y0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=1,k2=0):x0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=0,k2=1):(i1=0,j1=0,k1=1,i2=1,j2=0,k2=1):z0>y0?(i1=0,j1=0,k1=1,i2=0,j2=1,k2=1):z0>x0?(i1=0,j1=1,k1=0,i2=0,j2=1,k2=1):(i1=0,j1=1,k1=0,i2=1,j2=1,k2=0);var x1=x0-i1+G3,y1=y0-j1+G3,z1=z0-k1+G3,x2=x0-i2+2*G3,y2=y0-j2+2*G3,z2=z0-k2+2*G3,x3=x0-1+3*G3,y3=y0-1+3*G3,z3=z0-1+3*G3,ii=255&i,jj=255&j,kk=255&k,gi0=this.perm[ii+this.perm[jj+this.perm[kk]]]%12,gi1=this.perm[ii+i1+this.perm[jj+j1+this.perm[kk+k1]]]%12,gi2=this.perm[ii+i2+this.perm[jj+j2+this.perm[kk+k2]]]%12,gi3=this.perm[ii+1+this.perm[jj+1+this.perm[kk+1]]]%12,t0=.6-x0*x0-y0*y0-z0*z0;0>t0?n0=0:(t0*=t0,n0=t0*t0*this.dot(this.grad3[gi0],x0,y0,z0));var t1=.6-x1*x1-y1*y1-z1*z1;0>t1?n1=0:(t1*=t1,n1=t1*t1*this.dot(this.grad3[gi1],x1,y1,z1));var t2=.6-x2*x2-y2*y2-z2*z2;0>t2?n2=0:(t2*=t2,n2=t2*t2*this.dot(this.grad3[gi2],x2,y2,z2));var t3=.6-x3*x3-y3*y3-z3*z3;return 0>t3?n3=0:(t3*=t3,n3=t3*t3*this.dot(this.grad3[gi3],x3,y3,z3)),32*(n0+n1+n2+n3)}},{}],4:[function(require,module){!function(){function MersenneTwister(seed){Random.call(this),this._index=0,this._state=new Array(624),this._state[0]=null!=seed?seed:4294967295*Math.random()|0,this._seed=this._state[0];var i,MT=this._state;for(i=1;624>i;i++)MT[i]=MT[i-1]^MT[i-1]>>>30,MT[i]=1812433253*MT[i]+i,MT[i]=MT[i]&(MT[i]<<32)-1}var Random;if("undefined"!=typeof module){if(module.exports=MersenneTwister,"function"==typeof require)var Random=require("../")}else Random=this.Random,Random.MT=MersenneTwister;var $=MersenneTwister.prototype=Object.create(Random.prototype);$.constructor=MersenneTwister,$._generateNumbers=function(){var i,y,MT=this._state;for(i=0;624>i;i++)y=2147483648&MT[i],y+=2147483647&MT[(i+1)%624],MT[i]=MT[(i+397)%624]^y>>>1,y%2!==0&&(MT[i]=2567483615^MT[i])},$.uniform=function(){0===this._index&&this._generateNumbers();var y=this._state[this._index];return y^=y>>>11,y^=y<<7&2636928640,y^=y<<15&4022730752,y^=y>>>18,this._index=(this._index+1)%624,(y>>>0)*(1/4294967296)}}()},{"../":7}],5:[function(require,module){!function(){function ParkMiller(seed){Random.call(this),this._seed=null!=seed?seed:1}var Random;if("undefined"!=typeof module){if(module.exports=ParkMiller,"function"==typeof require)var Random=require("../")}else Random=this.Random,Random.PM=ParkMiller;var $=ParkMiller.prototype=Object.create(Random.prototype);$.constructor=ParkMiller,$.uniform=function(){var hi=16807*(this._seed>>16),lo=16807*(65535&this._seed)+((32767&hi)<<16)+(hi>>15);return this._seed=lo>2147483647?lo-2147483647:lo,this._seed/2147483647}}()},{"../":7}],6:[function(require,module){!function(){function XOR(x,y,z,w){Random.call(this),this.x=null!=x?x:this.x,this.y=null!=y?y:this.y,this.z=null!=z?z:this.z,this.w=null!=w?w:this.w}var Random;if("undefined"!=typeof module){if(module.exports=XOR,"function"==typeof require)var Random=require("../")}else Random=this.Random,Random.XOR=XOR;var $=XOR.prototype=Object.create(Random.prototype);$.constructor=XOR,$.x=123456789,$.y=362436069,$.z=521288629,$.w=88675123,$.uniform=function(){var t=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>19^(t^t>>8),this.w/2147483647}}()},{"../":7}],7:[function(require,module){function Random(){this._normal=null}Random.prototype={constructor:Random,get seed(){return this._seed},set seed(value){this.constructor.call(this,value)},next:function(){return 0|255*this.uniform()},random:function(){return this.uniform()},uniform:function(){return Math.random()},normal:function(){var x,y;if(null!=this._normal){var num=this._normal;return this._normal=null,num}return x=this.uniform()||Math.pow(2,-53),x=Math.sqrt(-2*Math.log(x)),y=2*Math.PI*this.uniform(),this._normal=x*Math.sin(y),x*Math.cos(y)},range:function(min,max){return null==min?this.uniform():(null==max&&(max=min,min=0),min+Math.floor(this.uniform()*(max-min)))},exp:function(){return-Math.log(this.uniform()||Math.pow(2,-53))},poisson:function(mean){for(var L=Math.exp(-(mean||1)),k=0,p=1;p>L;)p*=this.uniform(),k++;return k-1},gamma:function(a){var d,c,x,u,v;for(d=(1>a?1+a:a)-1/3,c=1/Math.sqrt(9*d);;){for(;;)if(x=this.normal(),v=Math.pow(1+c*x,3),v>0)break;if(u=this.uniform(),u>=1-.331*Math.pow(x,4)&&Math.log(u)>=.5*Math.pow(x,2)+d*(1-v+Math.log(v)))break}return a>1?d*v:d*v*Math.exp(this.exp()/-a)}},"undefined"!=typeof module&&(module.exports=Random,"function"==typeof require&&(Random.MT=require("./lib/mersenne-twister"),Random.PM=require("./lib/park-miller"),Random.XOR=require("./lib/xor")))},{"./lib/mersenne-twister":4,"./lib/park-miller":5,"./lib/xor":6}],8:[function(require,module){module.exports.Buffer=function(gl){var self=this;self.initialize=function(){self.buffer=gl.createBuffer()},self.bind=function(){gl.bindBuffer(gl.ARRAY_BUFFER,self.buffer)},self.set=function(data){self.bind(),gl.bufferData(gl.ARRAY_BUFFER,data,gl.STATIC_DRAW)},self.initialize()},module.exports.Renderable=function(gl,program,buffers,primitiveCount){var self=this;self.primitiveCount=primitiveCount,self.initialize=function(){},self.render=function(){program.use();for(name in buffers){var buffer=buffers[name].buffer,size=buffers[name].size;try{var location=program.attribs[name].location}catch(e){throw console.log("Could not find location for",name),e}buffer.bind(),gl.enableVertexAttribArray(location),gl.vertexAttribPointer(location,size,gl.FLOAT,!1,0,0)}gl.drawArrays(gl.TRIANGLES,0,3*primitiveCount);for(name in self.buffers)gl.disableVertexAttribArray(program.attributes[name].location)},self.initialize()},module.exports.Program=function(gl,vertexSource,fragmentSource){var self=this;self.initialize=function(){self.program=self.compileProgram(vertexSource,fragmentSource),self.attribs=self.gatherAttribs(),self.uniforms=self.gatherUniforms()},self.use=function(){gl.useProgram(self.program)},self.compileProgram=function(vertexSource,fragmentSource){var vertexShader=self.compileShader(vertexSource,gl.VERTEX_SHADER),fragmentShader=self.compileShader(fragmentSource,gl.FRAGMENT_SHADER),program=gl.createProgram();if(gl.attachShader(program,vertexShader),gl.attachShader(program,fragmentShader),gl.linkProgram(program),!gl.getProgramParameter(program,gl.LINK_STATUS))throw console.log(gl.getProgramInfoLog(program)),"Failed to compile program.";return program},self.compileShader=function(source,type){var shader=gl.createShader(type);if(gl.shaderSource(shader,source),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){var err=gl.getShaderInfoLog(shader),lineno=parseInt(err.split(":")[2]),split=source.split("\n");for(var i in split){var q=parseInt(i)+1;console.log(q+"  "+split[i]),i==lineno&&console.warn(err)}throw typeString=type==gl.VERTEX_SHADER?"vertex":"fragment","Failed to compile "+typeString+" shader."}return shader},self.setUniform=function(name,type){var args=Array.prototype.slice.call(arguments,2);self.use();try{var location=self.uniforms[name].location}catch(e){throw console.log(name),e}gl["uniform"+type].apply(gl,[location].concat(args))},self.gatherUniforms=function(){for(var uniforms={},nUniforms=gl.getProgramParameter(self.program,gl.ACTIVE_UNIFORMS),i=0;nUniforms>i;i++){var uniform=gl.getActiveUniform(self.program,i);uniforms[uniform.name]={name:uniform.name,location:gl.getUniformLocation(self.program,uniform.name),type:uniform.type,size:uniform.size}}return uniforms},self.gatherAttribs=function(){for(var attribs={},nAttribs=gl.getProgramParameter(self.program,gl.ACTIVE_ATTRIBUTES),i=0;nAttribs>i;i++){var attrib=gl.getActiveAttrib(self.program,i);attribs[attrib.name]={name:attrib.name,location:gl.getAttribLocation(self.program,attrib.name),type:attrib.type,size:attrib.size}}return attribs},self.initialize()}},{}],9:[function(require,module){module.exports=require("./core.js")},{"./core.js":8}],10:[function(require,module){var glm=require("gl-matrix"),surface=require("./surface");module.exports=function(radius,color,pos,sphereRenderer){var self=this;initialize=function(){self.reset()},self.reset=function(){self.radius=radius,self.alpha=1;var y=surface.height(pos[0],pos[1])+self.radius;self.p={x:pos[0],y:y,z:pos[1]},self.v={x:0,y:0,z:0}},self.update=function(){var f=surface.force(self.p.x,self.p.z),cf=self.customBehavior();f[0]+=cf[0],f[2]+=cf[2],f[0]-=2*self.v.x,f[2]-=2*self.v.z,self.v.x+=.04*f[0],self.v.z+=.04*f[2],self.p.x+=.01*self.v.x,self.p.z+=.01*self.v.z,self.p.y=surface.height(self.p.x,self.p.z)+self.radius},self.customBehavior=function(){return[0,0,0]},self.render=function(view,projection,pulse){var a=glm.vec2.fromValues(pulse.center[0],pulse.center[2]),b=glm.vec2.fromValues(self.p.x,self.p.z),d=Math.abs(glm.vec2.distance(a,b)-pulse.age),h=.0125*Math.exp(100*-d);sphereRenderer.render([self.p.x,self.p.y+h,self.p.z],self.radius,color,self.alpha,view,projection)},initialize()}},{"./surface":17,"gl-matrix":1}],11:[function(require,module){var res=32;module.exports={chunk:{width:.3,depth:.1,height:.04,scale:1/6,octaves:2,res:{width:3*res,depth:res}},lightDir:[0,1,0],board:{depth:.5},player:{radius:.005}}},{}],12:[function(require){"use strict";function lose(){var text="";console.log(getScore(),getHighScore()),getScore()==getHighScore()&&(text+="NEW HIGH SCORE\n\n"),text+="You scored "+getScore()+" points.\n\n",text+=instructions,textPanels.purgatory.print(text),reset()}function getScore(){return Math.round(100*-boardZ)}function getHighScore(){return localStorage.getItem("highScore")||0}function reset(){boardZ=0,pulse.age=1e3,player.reset(),chaser.reset(),game.state="waiting"}function pulseEffect(){var a=Math.min(1,pulse.age);return a*a*a}function render(projection,position,target,up){var cam=[0+position[0],.3+position[1],boardZ+.6+position[2]];document.webkitFullscreenElement&&vr.capable&&vr.initialized&&(cam[1]+=.1,cam[2]-=.1);var target=glm.vec3.add(glm.vec3.create(),target,cam),view=glm.mat4.lookAt(glm.mat4.create(),cam,target,up);if(gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),surfaceManager.update(boardZ),surfaceManager.render(boardZ,player,chaser,view,projection,pulse),spaceBox(cam,view,projection),"running"===game.state||"dying"===game.state){var model=glm.mat4.create();glm.mat4.translate(model,model,[-q.chunk.width,0,boardZ-q.board.depth/2]),glm.mat4.rotateX(model,model,-Math.PI/4),textPanels.score.render(model,view,projection,1/1024);var model=glm.mat4.create();glm.mat4.translate(model,model,[-q.chunk.width,0,boardZ-q.board.depth/99999]),glm.mat4.rotateX(model,model,-Math.PI/4),textPanels.pulseReady.render(model,view,projection,1/1024)}var model=glm.mat4.create();if(glm.mat4.translate(model,model,[+q.chunk.width,0,boardZ-q.board.depth/2]),glm.mat4.rotateX(model,model,-Math.PI/4),textPanels.highScore.render(model,view,projection,1/1024),"waiting"===game.state){var model=glm.mat4.create();glm.mat4.translate(model,model,[0,.1,q.board.depth/4]),glm.mat4.rotateX(model,model,-Math.PI/4),textPanels.purgatory.render(model,view,projection,1/4500)}player.render(view,projection,pulse),chaser.render(view,projection,pulse)}function gameLoop(){if("running"===game.state){pulse.age+=.01,boardZ-=.002*pulseEffect(),chaser.update(),player.update();var score=getScore(),highScore=getHighScore();highScore=Math.max(score,highScore),localStorage.setItem("highScore",highScore),textPanels.score.print("Your Score\n"+score.toString());var recharge=Math.round(100*Math.min(1,pulse.age/pulseRecharge));100===recharge?(textPanels.pulseReady.setOptions(32,"Monospace","#0FF","center","rgba(0,0,0,0)"),textPanels.pulseReady.print("Tachyon\nPulse\nReady")):(textPanels.pulseReady.setOptions(32,"Monospace","#FFF","center","rgba(0,0,0,0)"),textPanels.pulseReady.print("Tachyon\nPulse\n"+recharge+"%")),(player.p.x>q.chunk.width/2||player.p.x<-q.chunk.width/2)&&(game.state="dying",boom.play()),(player.p.z>q.board.depth/2+boardZ||player.p.z<-q.board.depth/2+boardZ)&&(game.state="dying",boom.play()),chaser.p.x>q.chunk.width/2&&(chaser.p.x-=q.chunk.width,warp.play()),chaser.p.x<-q.chunk.width/2&&(chaser.p.x+=q.chunk.width,warp.play()),chaser.p.z>q.board.depth/2+boardZ&&(chaser.p.z-=q.board.depth,warp.play()),chaser.p.z<-q.board.depth/2+boardZ&&(chaser.p.z+=q.board.depth,warp.play())}if("dying"===game.state&&(player.radius+=.01,player.alpha*=.8,player.radius>=.25&&lose()),textPanels.highScore.print("High Score\n"+getHighScore().toString()),document.webkitFullscreenElement&&vr.capable&&vr.initialized)vr.render(render,.01,200);else{(canvas.width!==canvas.clientWidth||canvas.height!==canvas.clientHeight)&&(canvas.width=canvas.clientWidth,canvas.height=canvas.clientHeight),gl.viewport(0,0,canvas.width,canvas.height);var position=[0,0,-.3],target=[0,-.3,-.225],projection=glm.mat4.perspective(glm.mat4.create(),Math.PI/3,canvas.clientWidth/canvas.clientHeight,.01,200),up=[0,1,0];render(projection,position,target,up)}requestAnimationFrame(gameLoop)}var gl,canvas,programs,surfaceManager,sphereRenderer,kb,player,chaser,textPanels,spaceBox,vr,pulse,music,dink,whoosh,boom,warp,howler=require("howler"),glm=require("gl-matrix"),core=require("webgl.js"),SurfaceManager=(require("./surface"),require("./surface-manager")),SphereRenderer=require("./sphere-renderer"),TextPanel=require("./textpanel"),SpaceBox=require("./spacebox"),Character=require("./character"),q=require("./constants"),VR=require("./vr"),pulseRecharge=10,game={state:"waiting"},instructions="";instructions+="Instructions:\n\n",instructions+="You are the blue ball.\n",instructions+="The red ball will try\n",instructions+="to push you off the field.\nDon't let it.\n\n",instructions+="Use the arrow keys to move.\n",instructions+="Hit the spacebar to activate\n",instructions+="your tachyon pulse.\n\n",instructions+="Press space to begin.";var boardZ=0;window.onload=function(){music=new howler.Howl({urls:["static/music.ogg"],autoplay:!0,loop:!0,volume:.5}),whoosh=new howler.Howl({urls:["static/whoosh.ogg"]}),dink=new howler.Howl({urls:["static/dink.ogg"]}),boom=new howler.Howl({urls:["static/boom.ogg"]}),warp=new howler.Howl({urls:["static/warp.ogg"]}),canvas=document.getElementById("render-canvas"),canvas.width=window.innerWidth,canvas.height=window.innerHeight,gl=canvas.getContext("webgl",{antialias:!0}),gl.viewport(0,0,canvas.width,canvas.height),gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST),gl.enable(gl.CULL_FACE),vr=new VR(gl,canvas),vr.capable||(document.getElementById("help").style.display="none"),programs={};
var raw="#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec3 aColor;\n\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform mat4 uModel;\n\nuniform vec3 uPlayerPos;\nuniform vec3 uPulseCenter;\n\nuniform float uPulseAge;\n\nvarying vec3 vPos;\nvarying vec3 vColor;\nvarying vec3 vNormal;\n\nvoid main() {\n    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);\n    float d = abs(distance(uPulseCenter.xz, aPosition.xz) - uPulseAge);\n    float h = exp(-d * 100.0);\n    gl_Position.y += 0.0125 * h;\n    vColor = (1.0 - h) * aColor + h * vec3(0.0, 1.0, 1.0);\n    vPos = aPosition;\n    vNormal = aNormal;\n}\n\n\n==SPLIT==\n\n\n#version 100\nprecision highp float;\n\nuniform float uBoardZ;\nuniform float uBoardDepth;\nuniform float uBoardWidth;\n\nuniform vec3 uPlayerPos;\nuniform vec3 uChaserPos;\n\nvarying vec3 vColor;\nvarying vec3 vPos;\nvarying vec3 vNormal;\n\nvoid main() {\n    float i = clamp(dot(vNormal, normalize(vec3(0,  1,  0))), 0.0, 1.0);\n    float d = 0.005;\n    vec3 red = vec3(1.0, 0.0, 0.0) * clamp(d/distance(vPos, uChaserPos), 0.0, 1.0);\n    vec3 blue = vec3(0.0, 0.0, 1.0) * clamp(d/distance(vPos, uPlayerPos), 0.0, 1.0);\n    gl_FragColor = vec4(vColor * i + red + blue, 1.0);\n    float border = 0.004;\n    if (abs(vPos.x) > uBoardWidth * 0.5 - border || abs(vPos.z - uBoardZ) > uBoardDepth * 0.5 - border) {\n        gl_FragColor = vec4(0.0, 1.0, 1.0, 1.0);\n    }\n    if (abs(vPos.z - uBoardZ) > uBoardDepth * 0.5 || abs(vPos.x) > uBoardWidth * 0.5) {\n        discard;\n    }\n}\n".split("==SPLIT==");programs.surface=new core.Program(gl,raw[0],raw[1]);var raw="#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\n\nuniform mat4   uView;\nuniform mat4   uProjection;\nuniform mat4   uModel;\n\nvoid main() {\n    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);\n}\n\n\n==SPLIT==\n\n\n#version 100\nprecision highp float;\n\nuniform vec3 uColor;\nuniform float uAlpha;\n\nvoid main() {\n    gl_FragColor = vec4(uColor, uAlpha);\n}\n".split("==SPLIT==");programs.sphere=new core.Program(gl,raw[0],raw[1]);var raw="#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute vec2 aUV;\n\nuniform mat4   uView;\nuniform mat4   uProjection;\nuniform mat4   uModel;\n\nvarying vec2   vUV;\n\nvoid main() {\n    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);\n    vUV = aUV;\n}\n\n\n==SPLIT==\n\n\n#version 100\nprecision highp float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vUV;\n\nvoid main() {\n    gl_FragColor = texture2D(uSampler, vUV);\n}\n".split("==SPLIT==");programs.text=new core.Program(gl,raw[0],raw[1]),surfaceManager=new SurfaceManager(gl,programs.surface),sphereRenderer=new SphereRenderer(gl,programs.sphere),spaceBox=new SpaceBox(gl,1024,100),textPanels={highScore:new TextPanel(gl,programs.text),score:new TextPanel(gl,programs.text),purgatory:new TextPanel(gl,programs.text),pulseReady:new TextPanel(gl,programs.text)},textPanels.highScore.setOptions(32,"Monospace","#FFF","center","rgba(0,0,0,0)"),textPanels.score.setOptions(32,"Monospace","#FFF","center","rgba(0,0,0,0)"),textPanels.purgatory.setOptions(32,"Monospace","#FFF","center","rgba(0,0,0,0.9)",20),textPanels.pulseReady.setOptions(32,"Monospace","#0FF","center","rgba(0,0,0,0)"),textPanels.purgatory.print(instructions),textPanels.pulseReady.print("Tachyon\nPulse\nReady"),kb={},document.addEventListener("keydown",function(e){32===e.which&&"waiting"===game.state?game.state="running":32===e.which&&"running"===game.state&&pulse.age>pulseRecharge&&(pulse.age=0,pulse.center=[player.p.x,player.p.y,player.p.z],chaser.v.x=0,chaser.v.y=0,chaser.v.z=0,whoosh.play()),kb[e.which]=!0}),document.addEventListener("keyup",function(e){kb[e.which]=!1}),document.addEventListener("keypress",function(e){e.charCode=="f".charCodeAt(0)&&vr.fullscreen(),vr.capable&&e.charCode=="r".charCodeAt(0)&&vr.zero()}),player=new Character(q.player.radius,[.5,.5,1],[0,0],sphereRenderer),player.customBehavior=function(){var cf=[0,0,0];kb[38]&&(cf[2]-=1),kb[40]&&(cf[2]+=1),kb[37]&&(cf[0]-=1),kb[39]&&(cf[0]+=1);var d=glm.vec2.sub(glm.vec2.create(),[player.p.x,player.p.z],[chaser.p.x,chaser.p.z]);return glm.vec2.length(d)<.01&&(glm.vec2.normalize(d,d),glm.vec2.scale(d,d,10),cf[0]+=d[0],cf[2]+=d[1],dink.play()),cf},chaser=new Character(.005,[1,.5,.5],[0,.1],sphereRenderer),chaser.customBehavior=function(){var cf=glm.vec3.create(),d=glm.vec2.sub(glm.vec2.create(),[player.p.x,player.p.z],[chaser.p.x,chaser.p.z]);return glm.vec2.normalize(d,d),cf[0]=d[0]*pulseEffect(),cf[2]=d[1]*pulseEffect(),cf},pulse={age:1e3,center:[0,0,0]},gameLoop()}},{"./character":10,"./constants":11,"./spacebox":14,"./sphere-renderer":15,"./surface":17,"./surface-manager":16,"./textpanel":18,"./vr":19,"gl-matrix":1,howler:2,"webgl.js":9}],13:[function(require,module){var glm=require("gl-matrix");module.exports=function(resolution,radius){"use strict";for(var position=[],normal=[],y=0;resolution>y;y++)for(var z=0;resolution>z;z++){var a=[0,y+0,z+0],b=[0,y+0,z+1],c=[0,y+1,z+1],d=[0,y+1,z+0];position.push.apply(position,a),position.push.apply(position,b),position.push.apply(position,c),position.push.apply(position,a),position.push.apply(position,c),position.push.apply(position,d);var a=[resolution,y+0,z+0],b=[resolution,y+0,z+1],c=[resolution,y+1,z+1],d=[resolution,y+1,z+0];position.push.apply(position,a),position.push.apply(position,c),position.push.apply(position,b),position.push.apply(position,a),position.push.apply(position,d),position.push.apply(position,c)}for(var x=0;resolution>x;x++)for(var z=0;resolution>z;z++){var a=[x+0,resolution,z+1],b=[x+1,resolution,z+1],c=[x+1,resolution,z+0],d=[x+0,resolution,z+0];position.push.apply(position,a),position.push.apply(position,b),position.push.apply(position,c),position.push.apply(position,a),position.push.apply(position,c),position.push.apply(position,d);var a=[x+0,0,z+1],b=[x+1,0,z+1],c=[x+1,0,z+0],d=[x+0,0,z+0];position.push.apply(position,a),position.push.apply(position,c),position.push.apply(position,b),position.push.apply(position,a),position.push.apply(position,d),position.push.apply(position,c)}for(var x=0;resolution>x;x++)for(var y=0;resolution>y;y++){var a=[x+0,y+0,resolution],b=[x+1,y+0,resolution],c=[x+1,y+1,resolution],d=[x+0,y+1,resolution];position.push.apply(position,a),position.push.apply(position,b),position.push.apply(position,c),position.push.apply(position,a),position.push.apply(position,c),position.push.apply(position,d);var a=[x+0,y+0,0],b=[x+1,y+0,0],c=[x+1,y+1,0],d=[x+0,y+1,0];position.push.apply(position,a),position.push.apply(position,c),position.push.apply(position,b),position.push.apply(position,a),position.push.apply(position,d),position.push.apply(position,c)}for(var i=0;i<position.length;i++)position[i]-=.5*resolution;for(var i=0;i<position.length/3;i++){var a=position[3*i+0],b=position[3*i+1],c=position[3*i+2],n=glm.vec3.normalize(glm.vec3.create(),[a,b,c]);position[3*i+0]=n[0],position[3*i+1]=n[1],position[3*i+2]=n[2],normal.push.apply(normal,n)}for(var i=0;i<position.length;i++)position[i]*=radius;return{position:new Float32Array(position),normal:new Float32Array(normal)}}},{"gl-matrix":1}],14:[function(require,module){var glm=require("gl-matrix"),core=require("webgl.js");module.exports=function(gl,resolution,radius){function createTexture(){var c=document.createElement("canvas");c.width=c.height=resolution;var x=c.getContext("2d");x.drawImage(canvas,0,0);var t=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,t),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null),t}canvas=document.createElement("canvas"),canvas.width=canvas.height=resolution,localGL=canvas.getContext("webgl");var raw="#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute vec3 aPoint;\n\nvarying vec3 vPoint;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 1.0);\n    vPoint = aPoint;\n}\n\n\n// __split__\n\n\n#version 100\nprecision highp float;\n\nvarying vec3 vPoint;\n\n// __noise__\n\nfloat stars(vec3 p) {\n    float n = 0.5 * cnoise(p * 512.0) + 0.5;\n    n = pow(n, 16.0);\n    return n;    \n}\n\nfloat nebula(vec3 p) {\n    float scale = 0.5;\n    float mag = 2.0;\n    vec3 offset = p;\n    for (int d = 0; d < 8; d++) {\n        vec3 q = vec3(0.0,0.0,0.0);\n        q.x += mag * cnoise(offset * scale + 1.1);\n        q.y += mag * cnoise(offset * scale + 10.2);\n        q.z += mag * cnoise(offset * scale + 100.3);\n        offset += q;\n        mag *= 0.5;\n        scale *= 2.0;\n    }\n    float i = 0.5 * cnoise(p + offset) + 0.5;\n    i = min(1.0, pow(i, 4.0) * 2.0);\n    return i;\n}\n\nvoid main() {\n    vec3 p = normalize(vPoint);\n    vec3 color = vec3(0.0, 0.0, 0.0);\n    color += vec3(1.0, 1.0, 1.0) * stars(p);\n    color += vec3(1.0, 0.5, 0.0) * nebula(p + 100.0);\n    color += vec3(0.0, 0.5, 1.0) * nebula(p + 1000.0);\n    // color += vec3(0.25, 1.0, 0.25) * nebula(p + 10000.0);\n    gl_FragColor = vec4(color, 1.0);\n}\n",noise="//\n// GLSL textureless classic 3D noise cnoise,\n// with an RSL-style periodic variant pnoise.\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-10-11\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x)\n{\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}";raw=raw.replace("// __noise__",noise),raw=raw.split("// __split__");var program=new core.Program(localGL,raw[0],raw[1]);localGL.viewport(0,0,resolution,resolution);var position=[-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0],point=[-1,-1,-1,1,-1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,1,-1],attribs={aPosition:{buffer:new core.Buffer(localGL),size:3},aPoint:{buffer:new core.Buffer(localGL),size:3}};attribs.aPosition.buffer.set(new Float32Array(position)),attribs.aPoint.buffer.set(new Float32Array(point));var count=position.length/9,renderable=new core.Renderable(localGL,program,attribs,count);attribs.aPoint.buffer.set(new Float32Array([-1,-1,-1,1,-1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,1,-1])),renderable.render();var tnz=createTexture();attribs.aPoint.buffer.set(new Float32Array([1,-1,1,-1,-1,1,-1,1,1,1,-1,1,-1,1,1,1,1,1])),renderable.render();var tpz=createTexture();attribs.aPoint.buffer.set(new Float32Array([-1,1,-1,1,1,-1,1,1,1,-1,1,-1,1,1,1,-1,1,1])),renderable.render();var tpy=createTexture();attribs.aPoint.buffer.set(new Float32Array([-1,-1,1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,-1,-1,-1])),renderable.render();var tny=createTexture();attribs.aPoint.buffer.set(new Float32Array([-1,-1,1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1,1])),renderable.render();var tnx=createTexture();attribs.aPoint.buffer.set(new Float32Array([1,-1,-1,1,-1,1,1,1,1,1,-1,-1,1,1,1,1,1,-1])),renderable.render();var tpx=createTexture(),raw="#version 100\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute vec2 aUV;\n\nuniform mat4   uView;\nuniform mat4   uProjection;\nuniform mat4   uModel;\n\nvarying vec2   vUV;\n\nvoid main() {\n    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);\n    vUV = aUV;\n}\n\n\n==SPLIT==\n\n\n#version 100\nprecision highp float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vUV;\n\nvoid main() {\n    gl_FragColor = texture2D(uSampler, vUV);\n}\n".split("==SPLIT=="),program=new core.Program(gl,raw[0],raw[1]),position=[-1,-1,-1,1,-1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,1,-1],uv=[0,0,1,0,1,1,0,0,1,1,0,1],attribs={aPosition:{buffer:new core.Buffer(gl),size:3},aUV:{buffer:new core.Buffer(gl),size:2}};attribs.aPosition.buffer.set(new Float32Array(position)),attribs.aUV.buffer.set(new Float32Array(uv));var count=position.length/9,renderable=new core.Renderable(gl,program,attribs,count);return function(eye,view,projection){program.use(),program.setUniform("uView","Matrix4fv",!1,view),program.setUniform("uProjection","Matrix4fv",!1,projection);var model=glm.mat4.create();glm.mat4.translate(model,model,eye),glm.mat4.scale(model,model,[radius,radius,radius]),program.setUniform("uModel","Matrix4fv",!1,model),gl.bindTexture(gl.TEXTURE_2D,tnz),renderable.render();var model=glm.mat4.create();glm.mat4.translate(model,model,eye),glm.mat4.scale(model,model,[radius,radius,radius]),glm.mat4.rotateY(model,model,Math.PI),program.setUniform("uModel","Matrix4fv",!1,model),gl.bindTexture(gl.TEXTURE_2D,tpz),renderable.render();var model=glm.mat4.create();glm.mat4.translate(model,model,eye),glm.mat4.scale(model,model,[radius,radius,radius]),glm.mat4.rotateX(model,model,-Math.PI/2),program.setUniform("uModel","Matrix4fv",!1,model),gl.bindTexture(gl.TEXTURE_2D,tpy),renderable.render();var model=glm.mat4.create();glm.mat4.translate(model,model,eye),glm.mat4.scale(model,model,[radius,radius,radius]),glm.mat4.rotateX(model,model,Math.PI/2),program.setUniform("uModel","Matrix4fv",!1,model),gl.bindTexture(gl.TEXTURE_2D,tny),renderable.render();var model=glm.mat4.create();glm.mat4.translate(model,model,eye),glm.mat4.scale(model,model,[radius,radius,radius]),glm.mat4.rotateY(model,model,Math.PI/2),program.setUniform("uModel","Matrix4fv",!1,model),gl.bindTexture(gl.TEXTURE_2D,tnx),renderable.render();var model=glm.mat4.create();glm.mat4.translate(model,model,eye),glm.mat4.scale(model,model,[radius,radius,radius]),glm.mat4.rotateY(model,model,-Math.PI/2),program.setUniform("uModel","Matrix4fv",!1,model),gl.bindTexture(gl.TEXTURE_2D,tpx),renderable.render()}}},{"gl-matrix":1,"webgl.js":9}],15:[function(require,module){var glm=require("gl-matrix"),core=require("webgl.js"),quadSphere=require("./quadsphere");module.exports=function(gl,program){function initialize(){var s=quadSphere(8,1),attribs={aPosition:{buffer:new core.Buffer(gl),size:3}};attribs.aPosition.buffer.set(s.position),qSphere=new core.Renderable(gl,program,attribs,s.position.length/9)}var qSphere,self=this;self.render=function(position,radius,color,alpha,view,projection){program.use(),program.setUniform("uView","Matrix4fv",!1,view),program.setUniform("uProjection","Matrix4fv",!1,projection);var model=glm.mat4.create();glm.mat4.translate(model,model,position),glm.mat4.scale(model,model,[radius,radius,radius]),program.setUniform("uModel","Matrix4fv",!1,model),program.setUniform("uColor","3fv",color),program.setUniform("uAlpha","1f",alpha),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),qSphere.render(),gl.disable(gl.BLEND)},initialize()}},{"./quadsphere":13,"gl-matrix":1,"webgl.js":9}],16:[function(require,module){{var core=require("webgl.js"),glm=require("gl-matrix"),q=require("./constants"),random=new(require("rng").MT)("foo"),Simplex=require("perlin-simplex");new Simplex(random)}module.exports=function(gl,program){function initialize(){worker.onmessage=onMessage}function onMessage(e){var chunkIndex=e.data.chunkIndex,chunk=e.data.chunk,attribs={aPosition:{buffer:new core.Buffer(gl),size:3},aNormal:{buffer:new core.Buffer(gl),size:3},aColor:{buffer:new core.Buffer(gl),size:3}};attribs.aPosition.buffer.set(chunk.position),attribs.aNormal.buffer.set(chunk.normal),attribs.aColor.buffer.set(chunk.color);var count=chunk.position.length/9;chunks[chunkIndex]=new core.Renderable(gl,program,attribs,count),delete queue[chunkIndex]}var self=this,chunks={},queue={},worker=new Worker("static/surface-worker-bundle.js");self.update=function(boardZ){for(var needed={},radius=3,z=boardZ-radius*q.chunk.depth;z<=boardZ+radius*q.chunk.depth;z+=.1*q.chunk.depth){var chunkIndex=Math.floor(z/q.chunk.depth);needed[chunkIndex]=chunkIndex}for(key in needed)void 0===chunks[key]&&void 0===queue[key]&&(queue[key]=!0,worker.postMessage({chunkIndex:key}));for(key in chunks)void 0===needed[key]&&delete chunks[key]},self.render=function(boardZ,player,chaser,view,projection,pulse){program.use(),program.setUniform("uView","Matrix4fv",!1,view),program.setUniform("uProjection","Matrix4fv",!1,projection),program.setUniform("uBoardZ","1f",boardZ),program.setUniform("uBoardDepth","1f",q.board.depth),program.setUniform("uBoardWidth","1f",q.chunk.width),program.setUniform("uPlayerPos","3fv",[player.p.x,player.p.y,player.p.z]),program.setUniform("uChaserPos","3fv",[chaser.p.x,chaser.p.y,chaser.p.z]),program.setUniform("uPulseAge","1f",pulse.age),program.setUniform("uPulseCenter","3fv",pulse.center);var model=glm.mat4.create();program.setUniform("uModel","Matrix4fv",!1,model);for(var key in chunks)chunks[key].render()},initialize()}},{"./constants":11,"gl-matrix":1,"perlin-simplex":3,rng:7,"webgl.js":9}],17:[function(require,module){function height(x,z){for(var v=0,s=q.chunk.scale,h=q.chunk.height*Math.max(0,Math.min(-z/10,1)),i=0;i<q.chunk.octaves;i++)v+=h*simplex.noise(x/s,z/s),h*=.5,s*=.5;return v}function gradient(x,z){var dr=.01,d0=height(x,z),dx=height(x+dr,z),dz=height(x,z+dr);return[(dx-d0)/dr,0,(dz-d0)/dr]}function force(x,z){var grad=gradient(x,z);return[-grad[0],-grad[1],-grad[2]]}function point(x,z){var dr=.01,d0=height(x,z),dx=height(x+dr,z),dz=height(x,z+dr),n=normal([x,d0,z],[x+dr,dx,z],[x,dz,z+dr]);return{p:[x,d0,z],n:n}}function normal(a,b,c){var ab=glm.vec3.sub(glm.vec3.create(),b,a),ac=glm.vec3.sub(glm.vec3.create(),c,a),cross=glm.vec3.cross(glm.vec3.create(),ac,ab);return glm.vec3.normalize(glm.vec3.create(),cross)}function getChunk(chunkIndex){for(var position=[],normal=[],color=[],dz=q.chunk.depth/q.chunk.res.depth,dx=q.chunk.width/q.chunk.res.width,d0=0,x=0;x<q.chunk.res.width;x++)for(var xp=x/q.chunk.res.width*q.chunk.width-.5*q.chunk.width,z=0;z<q.chunk.res.depth;z++){var zp=z/q.chunk.res.depth*q.chunk.depth+chunkIndex*q.chunk.depth,a=point(xp+d0,zp+dz),b=point(xp+dx,zp+dz),c=point(xp+dx,zp+d0),d=point(xp+d0,zp+d0);position.push.apply(position,a.p),position.push.apply(position,b.p),position.push.apply(position,d.p),position.push.apply(position,b.p),position.push.apply(position,c.p),position.push.apply(position,d.p),normal.push.apply(normal,a.n),normal.push.apply(normal,b.n),normal.push.apply(normal,d.n),normal.push.apply(normal,b.n),normal.push.apply(normal,c.n),normal.push.apply(normal,d.n);var c=.02*Math.random()+.25,c=[c,c,c];color.push.apply(color,c),color.push.apply(color,c),color.push.apply(color,c),color.push.apply(color,c),color.push.apply(color,c),color.push.apply(color,c)}return{position:new Float32Array(position),normal:new Float32Array(normal),color:new Float32Array(color)}}var glm=require("gl-matrix"),random=new(require("rng").MT)("foo"),Simplex=require("perlin-simplex"),q=require("./constants"),simplex=new Simplex(random);module.exports={getChunk:getChunk,height:height,force:force}},{"./constants":11,"gl-matrix":1,"perlin-simplex":3,rng:7}],18:[function(require,module){var glm=require("gl-matrix"),core=require("webgl.js");module.exports=function(gl,program){function updateTexture(){gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),gl.bindTexture(gl.TEXTURE_2D,self.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,self.canvas),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1)}var self=this;initialize=function(){self.size=64,self.font="monospace",self.color="#333",self.align="center",self.background="#FFF",self.padding=8;var n=-.5,p=.5,position=new Float32Array([n,n,0,p,n,0,p,p,0,n,n,0,p,p,0,n,p,0]),uv=new Float32Array([0,0,1,0,1,1,0,0,1,1,0,1]),attribs={aPosition:{buffer:new core.Buffer(gl),size:3},aUV:{buffer:new core.Buffer(gl),size:2}};attribs.aPosition.buffer.set(position),attribs.aUV.buffer.set(uv);var count=position.length/9;self.quad=new core.Renderable(gl,program,attribs,count),self.canvas=document.createElement("canvas"),self.canvas.width=self.canvas.height=1,self.ctx=self.canvas.getContext("2d"),self.texture=gl.createTexture(),updateTexture()},self.setOptions=function(size,font,color,align,background,padding){self.size=void 0===size?self.size:size,self.font=void 0===font?self.font:font,self.color=void 0===color?self.color:color,self.align=void 0===align?self.align:align,self.background=void 0===background?self.background:background,self.padding=void 0===padding?self.padding:padding},self.print=function(text){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");text=text.split("\n"),ctx.font=self.size+"px "+self.font;for(var width=0,i=0;i<text.length;i++)width=Math.max(width,Math.ceil(ctx.measureText(text[i]).width))+2*self.padding;var height=self.size*text.length+2*self.padding;canvas.width=width,canvas.height=height,ctx.fillStyle=self.background,ctx.fillRect(0,0,width,height),ctx.font=self.size+"px "+self.font,ctx.fillStyle=self.color,ctx.textAlign=self.align,ctx.textBaseline="middle";var x,y=self.size/2;"left"===self.align?x=0:"center"===self.align?x=width/2:"right"===self.align&&(x=width);for(var i=0;i<text.length;i++)ctx.fillText(text[i],x+self.padding,y+self.padding),y+=self.size;for(var potW=1,potH=1;potW<canvas.width;)potW*=2;for(;potH<canvas.height;)potH*=2;self.canvas.width=potW,self.canvas.height=potH,self.ctx.drawImage(canvas,0,0,potW,potH),updateTexture()},self.render=function(model,view,projection,scale){program.use(),program.setUniform("uView","Matrix4fv",!1,view),program.setUniform("uProjection","Matrix4fv",!1,projection);var _model=glm.mat4.create();glm.mat4.scale(_model,model,[scale*self.canvas.width,scale*self.canvas.height,1]),program.setUniform("uModel","Matrix4fv",!1,_model),gl.bindTexture(gl.TEXTURE_2D,self.texture),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),self.quad.render(),gl.disable(gl.BLEND),gl.bindTexture(gl.TEXTURE_2D,null)},initialize()}},{"gl-matrix":1,"webgl.js":9}],19:[function(require,module){var glm=require("gl-matrix");module.exports=function(gl,element){"use strict";function initialize(){posOffset=glm.vec3.create(),oriOffset=glm.quat.create(),self.capable=!0,self.initialized=!1;try{navigator.getVRDevices().then(function(vrdevs){for(var i=0;i<vrdevs.length;i++)if(vrdevs[i]instanceof HMDVRDevice){vrHMD=vrdevs[i];break}for(var i=0;i<vrdevs.length;i++)if(vrdevs[i]instanceof PositionSensorVRDevice&&vrdevs[i].hardwareUnitId==vrHMD.hardwareUnitId){vrHMDSensor=vrdevs[i];break}var et=vrHMD.getEyeTranslation("left");halfIPD=glm.vec3.length(glm.vec3.fromValues(et.x,et.y,et.z)),fovLeft=vrHMD.getRecommendedEyeFieldOfView("left"),fovRight=vrHMD.getRecommendedEyeFieldOfView("right"),self.initialized=!0})}catch(e){console.warn("Unable to initialize VR."),self.capable=!1}}function FovToNDCScaleOffset(fov){var pxscale=2/(fov.leftTan+fov.rightTan),pxoffset=(fov.leftTan-fov.rightTan)*pxscale*.5,pyscale=2/(fov.upTan+fov.downTan),pyoffset=(fov.upTan-fov.downTan)*pyscale*.5;return{scale:[pxscale,pyscale],offset:[pxoffset,pyoffset]}}function FovPortToProjection(fov,rightHanded,zNear,zFar){rightHanded=void 0===rightHanded?!0:rightHanded,zNear=void 0===zNear?.01:zNear,zFar=void 0===zFar?1e4:zFar;var handednessScale=rightHanded?-1:1,m=glm.mat4.create(),scaleAndOffset=FovToNDCScaleOffset(fov);return m[0]=scaleAndOffset.scale[0],m[1]=0,m[2]=scaleAndOffset.offset[0]*handednessScale,m[3]=0,m[4]=0,m[5]=scaleAndOffset.scale[1],m[6]=-scaleAndOffset.offset[1]*handednessScale,m[7]=0,m[8]=0,m[9]=0,m[10]=zFar/(zNear-zFar)*-handednessScale,m[11]=zFar*zNear/(zNear-zFar),m[12]=0,m[13]=0,m[14]=handednessScale,m[15]=0,glm.mat4.transpose(m,m),m}function FovToProjection(fov,rightHanded,zNear,zFar){var fovPort={upTan:Math.tan(fov.upDegrees*Math.PI/180),downTan:Math.tan(fov.downDegrees*Math.PI/180),leftTan:Math.tan(fov.leftDegrees*Math.PI/180),rightTan:Math.tan(fov.rightDegrees*Math.PI/180)};return FovPortToProjection(fovPort,rightHanded,zNear,zFar)}var vrHMD,vrHMDSensor,halfIPD,fovLeft,fovRight,posOffset,oriOffset,self=this;self.fullscreen=function(){element.webkitRequestFullscreen({vrDisplay:vrHMD})},self.zero=function(){vrHMDSensor.zeroSensor()},self.render=function(renderFunc,zNear,zFar){var projLeft=FovToProjection(fovLeft,!0,zNear,zFar),projRight=FovToProjection(fovRight,!0,zNear,zFar),right=glm.vec3.fromValues(1,0,0),state=vrHMDSensor.getState(),o=state.orientation,orientation=glm.quat.fromValues(o.x,o.y,o.z,o.w);glm.vec3.transformQuat(right,right,orientation),glm.vec3.scale(right,right,halfIPD);var p=state.position,lPos=glm.vec3.fromValues(p.x,p.y,p.z);glm.vec3.sub(lPos,lPos,right);var rPos=glm.vec3.fromValues(p.x,p.y,p.z);glm.vec3.add(rPos,rPos,right);var target=glm.vec3.fromValues(0,0,-1),up=glm.vec3.fromValues(0,1,0);glm.vec3.transformQuat(target,target,orientation),glm.vec3.transformQuat(up,up,orientation),gl.enable(gl.SCISSOR_TEST);var width=element.width/2,height=element.height;gl.viewport(0,0,width,height),gl.scissor(0,0,width,height),renderFunc(projLeft,lPos,target,up),gl.viewport(width,0,width,height),gl.scissor(width,0,width,height),renderFunc(projRight,rPos,target,up),gl.disable(gl.SCISSOR_TEST)},initialize()}},{"gl-matrix":1}]},{},[12]);